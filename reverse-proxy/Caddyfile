{
    # Global options
    email barsukov.d@gmail.com
}

# Production environment (main domain) - Static files
quiz-sprint-tma.online {
    root * /var/www/tma/production
    file_server
    try_files {path} /index.html

    encode gzip

    log {
        output file /data/access-prod.log
        format json
    }
}

# Development environment - Chisel tunnel with HMR
dev.quiz-sprint-tma.online {
    reverse_proxy localhost:5174 {
        header_up Upgrade {>Upgrade}
        header_up Connection {>Connection}
    }

    encode gzip

    log {
        output file /data/access-dev.log
        format json
    }
}

# Staging environment - Static files
staging.quiz-sprint-tma.online {
    root * /var/www/tma/staging
    file_server
    try_files {path} /index.html

    encode gzip

    log {
        output file /data/access-staging.log
        format json
    }
}

# API backend
api.quiz-sprint-tma.online {
    # Reverse proxy to API server on port 3000
    reverse_proxy localhost:3000

    # CORS headers for TMA domains
    header {
        Access-Control-Allow-Origin "https://quiz-sprint-tma.online, https://dev.quiz-sprint-tma.online, https://staging.quiz-sprint-tma.online"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization"
        Access-Control-Max-Age "86400"
    }

    encode gzip

    log {
        output file /data/access-api.log
        format json
    }
}
