# 🏃 Solo Marathon (Бесконечный марафон)

## Общее описание

**Solo Marathon** — одиночный режим на выносливость, где игрок отвечает на вопросы до первой ошибки. Цель — установить личный рекорд и подняться в глобальном рейтинге. Режим идеален для тренировки и "убийства времени".

---

## 📋 Основные параметры

| Параметр | Значение |
|----------|----------|
| Количество игроков | 1 (соло) |
| Вопросов | Бесконечно (до ошибки) |
| Время на ответ | 20 секунд |
| Жизни в день | 3 (бесплатно) |
| Восстановление жизни | 1 жизнь каждые 4 часа |

---

## 🎯 Игровой процесс

### Этап 1: Главный экран режима
```
┌─────────────────────────────────────┐
│                                     │
│         🏃 SOLO MARATHON            │
│                                     │
│     ┌───────────────────────┐       │
│     │  🏆 Твой рекорд: 47   │       │
│     │  🌍 Мировой: 312      │       │
│     └───────────────────────┘       │
│                                     │
│         ❤️ ❤️ ❤️                    │
│         3 жизни                     │
│                                     │
│     ┌─────────────────────────┐     │
│     │      ▶ НАЧАТЬ           │     │
│     └─────────────────────────┘     │
│                                     │
│     ⏰ +1 жизнь через: 2:34:12      │
│                                     │
│     [ Выбрать категорию ▼ ]         │
│                                     │
└─────────────────────────────────────┘
```

### Этап 2: Выбор категории (опционально)
```
┌─────────────────────────────────────┐
│  ← Назад     Выбор категории        │
│─────────────────────────────────────│
│                                     │
│  ┌─────────────────────────────┐    │
│  │  🌈 Все категории           │    │
│  │  Рекорд: 47                 │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │  🌍 География               │    │
│  │  Рекорд: 23                 │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │  📚 История                 │    │
│  │  Рекорд: 31                 │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │  🔬 Наука                   │    │
│  │  Рекорд: 18                 │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │  🎬 Кино и ТВ               │    │
│  │  Рекорд: 29                 │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │  ⚽ Спорт                   │    │
│  │  Рекорд: 15                 │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │  🎵 Музыка                  │    │
│  │  Рекорд: 22                 │    │
│  └─────────────────────────────┘    │
│                                     │
└─────────────────────────────────────┘
```

### Этап 3: Игровой процесс
```
┌─────────────────────────────────────┐
│  🏃 Marathon         Вопрос #23     │
│─────────────────────────────────────│
│  ❤️ x1  │  🏆 Рекорд: 47  │  ⏱️ 15  │
│─────────────────────────────────────│
│                                     │
│     ████████████░░░░ 15 сек         │
│                                     │
│  Как называется столица Австралии?  │
│                                     │
│  ┌─────────────────────────────┐    │
│  │         Сидней              │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │         Мельбурн            │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │         Канберра ✓          │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │         Перт                │    │
│  └─────────────────────────────┘    │
│                                     │
│  ────────────────────────────────   │
│  💡 Подсказки: 50/50 [2]  ⏱️+10 [1] │
│                                     │
└─────────────────────────────────────┘
```

### Этап 4: Правильный ответ (продолжение)
```
┌─────────────────────────────────────┐
│                                     │
│            ✅ ВЕРНО!                │
│                                     │
│     Канберра — столица Австралии    │
│                                     │
│     +100 очков                      │
│     ⏱️ 3.2 сек — Бонус +50!         │
│                                     │
│     ────────────────────────────    │
│                                     │
│     📊 Текущий счёт: 3,450          │
│     🎯 Вопросов подряд: 23          │
│                                     │
│         Следующий вопрос...         │
│              ● ● ●                  │
│                                     │
└─────────────────────────────────────┘
```
- Длительность: 1.5 секунды
- Автопереход к следующему вопросу

### Этап 5: Неправильный ответ (потеря жизни)
```
┌─────────────────────────────────────┐
│                                     │
│            ❌ НЕВЕРНО!              │
│                                     │
│     Правильный ответ: Канберра      │
│                                     │
│            ❤️ → 💔                  │
│         Осталось жизней: 2          │
│                                     │
│  ┌─────────────────────────────┐    │
│  │   ▶ Продолжить (❤️ -1)      │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │   🎬 Смотреть рекламу       │    │
│  │   (сохранить жизнь)         │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │   🏠 Завершить забег        │    │
│  └─────────────────────────────┘    │
│                                     │
└─────────────────────────────────────┘
```

### Этап 6: Game Over (жизни закончились)
```
┌─────────────────────────────────────┐
│                                     │
│          💀 GAME OVER               │
│                                     │
│     ┌───────────────────────┐       │
│     │   Итог забега: 23     │       │
│     │   вопроса подряд      │       │
│     └───────────────────────┘       │
│                                     │
│     📊 Счёт: 3,450 очков            │
│     🏆 Твой рекорд: 47              │
│                                     │
│     ❤️ Жизней: 0                    │
│     ⏰ +1 жизнь через: 3:45:22      │
│                                     │
│  ┌─────────────────────────────┐    │
│  │   🎬 Смотреть рекламу       │    │
│  │   (+1 жизнь, играть снова)  │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │   💎 Купить жизни           │    │
│  │   (3 жизни за 50 монет)     │    │
│  └─────────────────────────────┘    │
│                                     │
│  [ Лидерборд ]     [ На главную ]   │
│                                     │
└─────────────────────────────────────┘
```

### Этап 7: Новый рекорд!
```
┌─────────────────────────────────────┐
│                                     │
│     🎉🎉🎉 НОВЫЙ РЕКОРД! 🎉🎉🎉     │
│                                     │
│            ⭐ 52 ⭐                  │
│         вопроса подряд!             │
│                                     │
│     Предыдущий рекорд: 47           │
│     Улучшение: +5 🚀                │
│                                     │
│     📊 Счёт: 7,820 очков            │
│                                     │
│     🌍 Мировой рейтинг: #1,247      │
│        из 89,432 игроков            │
│                                     │
│     🎁 Награда за рекорд:           │
│        +100 монет                   │
│        Достижение: "Марафонец"      │
│                                     │
│  ┌─────────────────────────────┐    │
│  │      📤 Поделиться          │    │
│  └─────────────────────────────┘    │
│                                     │
│  [ Играть снова ]  [ На главную ]   │
│                                     │
└─────────────────────────────────────┘
```

---

## 📈 Система сложности

### Адаптивная сложность
Сложность вопросов растёт с количеством правильных ответов:

| Вопросы | Сложность | Распределение |
|---------|-----------|---------------|
| 1-5 | Easy | 80% easy, 20% medium |
| 6-15 | Medium | 50% easy, 40% medium, 10% hard |
| 16-30 | Hard | 20% easy, 50% medium, 30% hard |
| 31-50 | Expert | 10% easy, 40% medium, 50% hard |
| 51+ | Master | 0% easy, 30% medium, 70% hard |

### Время на ответ
| Вопросы | Время |
|---------|-------|
| 1-10 | 20 сек |
| 11-25 | 15 сек |
| 26-50 | 12 сек |
| 51+ | 10 сек |

---

## 💡 Система подсказок

### Доступные подсказки
| Подсказка | Описание | Лимит/день | Восстановление |
|-----------|----------|------------|----------------|
| 50/50 | Убирает 2 неверных ответа | 3 | +1 каждые 6 часов |
| +10 сек | Добавляет время | 2 | +1 каждые 8 часов |
| Пропуск | Пропустить вопрос без потери жизни | 1 | +1 каждые 12 часов |
| Подсказка | Показать краткую подсказку | 2 | +1 каждые 6 часов |

### Получение подсказок
- Бесплатно: восстановление по времени
- За монеты: 50/50 = 20 монет, +10 сек = 15 монет
- За рекламу: любая подсказка за Rewarded Video
- Премиум: +2 ко всем лимитам

---

## ❤️ Система жизней

### Механика жизней
```
Жизни: ❤️ ❤️ ❤️ (максимум 3)

Потеря жизни:
- Неправильный ответ
- Таймаут (время вышло)

Восстановление:
- 1 жизнь каждые 4 часа (бесплатно)
- Rewarded Video = +1 жизнь (лимит 3/день)
- 50 монет = 3 жизни
- Премиум = безлимитные жизни
```

### Состояния жизней
```
┌─────────────────────────────────────┐
│                                     │
│  3 жизни: ❤️ ❤️ ❤️                  │
│  2 жизни: ❤️ ❤️ 🖤                  │
│  1 жизнь: ❤️ 🖤 🖤                  │
│  0 жизней: 🖤 🖤 🖤 (нельзя играть)  │
│                                     │
└─────────────────────────────────────┘
```

---

## 🏆 Система рекордов и лидерборда

### Типы рекордов
| Рекорд | Описание |
|--------|----------|
| Личный | Лучший результат игрока |
| Дневной | Лучший результат за сегодня |
| Недельный | Лучший результат за неделю |
| Исторический | Лучший результат за всё время |

### Лидерборды
```
┌─────────────────────────────────────┐
│  🏆 ЛИДЕРБОРД МАРАФОНА              │
│─────────────────────────────────────│
│                                     │
│  [ Всё время ] [ Неделя ] [ День ]  │
│                                     │
│  🥇 TriviaMaster     312 вопросов   │
│  🥈 QuizWizard       287 вопросов   │
│  🥉 BrainiacKing     264 вопросов   │
│  4. SmartAlec        251 вопросов   │
│  5. KnowledgeGuru    243 вопросов   │
│  ...                                │
│  1,247. 👤 Ты        52 вопросов    │
│                                     │
│  ────────────────────────────────   │
│  Всего игроков: 89,432              │
│  Ты в топ 1.4%! 🎯                  │
│                                     │
└─────────────────────────────────────┘
```

### Категорийные рекорды
- Отдельный лидерборд для каждой категории
- Игрок может быть в топе разных категорий
- Достижения за топ-позиции в категориях

---

## 💰 Монетизация

### Реклама
| Точка | Тип | Условие |
|-------|-----|---------|
| После game over | Interstitial | Каждый 2-й раз |
| Сохранение жизни | Rewarded | По выбору игрока |
| +1 жизнь | Rewarded | По выбору (макс 3/день) |
| +1 подсказка | Rewarded | По выбору |

### Внутриигровые покупки
| Товар | Цена | Описание |
|-------|------|----------|
| 3 жизни | 50 монет | Мгновенное пополнение |
| Пак подсказок | 100 монет | 5x50/50 + 3x+10сек + 2xПропуск |
| Безлимитные жизни (24ч) | 150 монет | Играй без ограничений |

### Премиум преимущества
- Безлимитные жизни
- +2 к лимиту всех подсказок
- Без рекламы
- Эксклюзивные категории

---

## 🎖️ Достижения

### Прогрессивные достижения
| Достижение | Условие | Награда |
|------------|---------|---------|
| Новичок | 10 вопросов подряд | 50 монет |
| Бегун | 25 вопросов подряд | 100 монет + рамка |
| Марафонец | 50 вопросов подряд | 200 монет + аватар |
| Ультрамарафонец | 100 вопросов подряд | 500 монет + титул |
| Легенда | 200 вопросов подряд | 1000 монет + уникальный скин |

### Категорийные достижения
| Достижение | Условие | Награда |
|------------|---------|---------|
| Географ | 30 вопросов в Географии | Значок 🌍 |
| Историк | 30 вопросов в Истории | Значок 📚 |
| Учёный | 30 вопросов в Науке | Значок 🔬 |
| Киноман | 30 вопросов в Кино | Значок 🎬 |
| Спортсмен | 30 вопросов в Спорте | Значок ⚽ |
| Меломан | 30 вопросов в Музыке | Значок 🎵 |
| Эрудит | 30+ в каждой категории | Уникальный титул |

### Серийные достижения
| Достижение | Условие |
|------------|---------|
| Ежедневный бегун | 7 дней подряд играл в Marathon |
| Преданный | 30 дней подряд |
| Фанатик | 100 дней подряд |

---

## 🔧 Технические требования

### Выбор вопросов
```python
def get_next_question(user_id, current_streak, category):
    # Определяем сложность
    difficulty = calculate_difficulty(current_streak)
    
    # Получаем пул вопросов
    if category == "all":
        pool = get_all_questions()
    else:
        pool = get_questions_by_category(category)
    
    # Фильтруем
    pool = filter_by_difficulty(pool, difficulty)
    pool = exclude_recently_shown(pool, user_id, days=7)
    pool = exclude_current_session(pool, user_id)
    
    # Выбираем случайный
    question = random.choice(pool)
    
    # Помечаем как показанный
    mark_as_shown(question.id, user_id)
    
    return question

def calculate_difficulty(streak):
    if streak <= 5:
        return {"easy": 0.8, "medium": 0.2, "hard": 0.0}
    elif streak <= 15:
        return {"easy": 0.5, "medium": 0.4, "hard": 0.1}
    elif streak <= 30:
        return {"easy": 0.2, "medium": 0.5, "hard": 0.3}
    elif streak <= 50:
        return {"easy": 0.1, "medium": 0.4, "hard": 0.5}
    else:
        return {"easy": 0.0, "medium": 0.3, "hard": 0.7}
```

### Система жизней
```python
class LivesSystem:
    MAX_LIVES = 3
    REGEN_TIME = 4 * 60 * 60  # 4 часа в секундах
    
    def get_lives(self, user_id):
        user = get_user(user_id)
        
        # Рассчитываем восстановленные жизни
        time_since_last = now() - user.last_life_update
        regenerated = int(time_since_last / self.REGEN_TIME)
        
        current_lives = min(
            user.lives + regenerated,
            self.MAX_LIVES
        )
        
        # Обновляем если нужно
        if regenerated > 0:
            update_user_lives(user_id, current_lives)
        
        return current_lives
    
    def time_to_next_life(self, user_id):
        user = get_user(user_id)
        if user.lives >= self.MAX_LIVES:
            return None
        
        time_since_last = now() - user.last_life_update
        remaining = self.REGEN_TIME - (time_since_last % self.REGEN_TIME)
        
        return remaining
```

### Структура данных сессии
```json
{
  "session_id": "sess_abc123",
  "user_id": "user_456",
  "category": "all",
  "started_at": "2026-01-24T15:30:00Z",
  "current_streak": 23,
  "score": 3450,
  "lives_used": 1,
  "hints_used": {
    "fifty_fifty": 1,
    "extra_time": 0,
    "skip": 0
  },
  "questions_answered": [
    {
      "question_id": "q_123",
      "answer": "C",
      "correct": true,
      "time": 4.2
    }
  ],
  "is_active": true
}
```

---

## 📊 Метрики для отслеживания

| Метрика | Целевое значение |
|---------|------------------|
| Средняя длина забега | 15-20 вопросов |
| Сессий на игрока в день | 3-5 |
| Rewarded ad completion | > 70% |
| Lives purchase conversion | > 5% |
| D1 retention | > 35% |
| Record improvement rate | > 20% игроков/неделя |

---

## 🎨 UI/UX рекомендации

### Прогресс-бар до рекорда
```
Текущий: 38 │████████████░░░░│ Рекорд: 47
              ↑ Осталось 9!
```

### Milestone празднования
- Каждые 10 вопросов: небольшая анимация + звук
- Каждые 25 вопросов: confetti + награда
- При побитии рекорда: полноэкранная анимация

### Мотивация при проигрыше
- "Ты ответил на 23 вопроса — это больше, чем 67% игроков!"
- "До рекорда оставалось всего 5 вопросов. Попробуй ещё!"

---

## 📱 Состояния экрана

| Состояние | Описание |
|-----------|----------|
| `ready` | Главный экран, есть жизни |
| `no_lives` | Нет жизней, показываем способы получить |
| `category_select` | Выбор категории |
| `playing` | Активная игра |
| `correct_answer` | Показ правильного ответа |
| `wrong_answer` | Показ ошибки, выбор продолжить/выйти |
| `game_over` | Конец игры, нет жизней |
| `new_record` | Празднование нового рекорда |

---

## ✅ Чек-лист запуска

- [ ] Жизни восстанавливаются корректно
- [ ] Сложность растёт плавно
- [ ] Подсказки работают правильно
- [ ] Рекорды сохраняются
- [ ] Лидерборд обновляется
- [ ] Rewarded ads работают
- [ ] Нет повторов вопросов в сессии
- [ ] Достижения разблокируются
- [ ] Оффлайн-режим (базовый) работает
