bounded_context:
  name: "Head-to-Head Duel"
  type: "Core Domain"
  description: "Real-time 1v1 quiz battles with fighting game mechanics including HP bars, combo attacks, critical hits, special moves, and dramatic combat feedback."
  business_rules:
    - "Each duel involves exactly 2 players answering the same questions simultaneously."
    - "Both players start with 100 HP."
    - "Correct answer deals 15 HP base damage to opponent."
    - "Incorrect answer deals 10 HP self-damage (reflect damage) and resets combo to 0."
    - "Timeout deals 5 HP self-damage and resets combo to 0."
    - "First player to reach 0 HP loses immediately (KO Victory)."
    - "After 10 questions, player with more HP wins (Decision Victory)."
    - "Equal HP after 10 questions results in a Draw."
    - "Combo System: Consecutive correct answers multiply damage (x1.0, x1.3, x1.6, x2.0)."
    - "Critical Hit: Answering within first 3 seconds (Speed Window) adds +50% damage."
    - "Special Moves: Auto-triggered at Combo 3 (40 HP), Combo 5 (50 HP + stun), Combo 7 (70 HP)."
    - "Defense: When both answer correctly, faster player deals full damage, slower deals 50%."
    - "Winner gains +50 Rating, +500 coins, +3 trophies."
    - "Loser gets -20 Rating, +100 coins (participation)."
    - "Perfect Victory (no HP lost) awards +100 bonus coins and 'Flawless Victory' badge."
    - "Comeback Victory (win from <20 HP) awards 'Clutch Master' achievement."
    - "Real-time sync required: Both players see live HP updates with <200ms latency."
    - "Server validates all answers and timestamps (anti-cheat)."
    - "Disconnect counts as forfeit with loser penalty."

value_objects:
  - name: "HP"
    type: "int"
    description: "Health Points representing player's remaining combat capacity."
    invariants:
      - "Must be between 0 and 100."
      - "Starts at 100 for both players."

  - name: "Combo"
    type: "int"
    description: "Counter tracking consecutive correct answers."
    invariants:
      - "Starts at 0."
      - "Resets to 0 on incorrect answer or timeout."

  - name: "VictoryType"
    type: "string"
    description: "Method by which duel was won."
    allowed_values: ["KO", "Decision", "Forfeit", "Draw"]

  - name: "DuelStatus"
    type: "string"
    description: "Current state of the duel."
    allowed_values: ["WaitingForPlayers", "InProgress", "Completed"]

aggregates:
  - name: "DuelGame"
    description: "Represents a real-time 1v1 quiz battle with fighting game mechanics."
    state:
      - name: "ID"
        type: "uuid.UUID"
      - name: "Player1ID"
        type: "uuid.UUID"
      - name: "Player2ID"
        type: "uuid.UUID"
      - name: "Player1HP"
        type: "HP"
      - name: "Player2HP"
        type: "HP"
      - name: "Player1Combo"
        type: "Combo"
      - name: "Player2Combo"
        type: "Combo"
      - name: "CurrentQuestionIndex"
        type: "int"
      - name: "Status"
        type: "DuelStatus"
      - name: "WinnerID"
        type: "*uuid.UUID"
      - name: "StartedAt"
        type: "int64"
      - name: "FinishedAt"
        type: "int64"

    methods:
      - name: "NewDuelGame"
        params:
          - { name: "player1ID", type: "uuid.UUID" }
          - { name: "player2ID", type: "uuid.UUID" }
        returns:
          - { type: "*DuelGame" }
        description: "Creates a new duel match."

      - name: "ProcessAnswers"
        params:
          - { name: "p1Answer", type: "*AnswerSubmission" }
          - { name: "p2Answer", type: "*AnswerSubmission" }
        returns:
          - { type: "error" }
        logic: |
          1. Validate both answers.
          2. Calculate damage for both players based on combo and speed.
          3. Apply defense (50% reduction) to the slower player if both are correct.
          4. Update HP and check for KO.
        description: "Processes simultaneous answers from both players."

entities:
  - name: "AnswerSubmission"
    state:
      - name: "PlayerID"
        type: "uuid.UUID"
      - name: "QuestionID"
        type: "uuid.UUID"
      - name: "IsCorrect"
        type: "bool"
      - name: "ResponseTimeMs"
        type: "int"
      - name: "SubmittedAt"
        type: "int64"

domain_events:
  - name: "DuelStarted"
    attributes:
      - { name: "DuelID", type: "uuid.UUID" }
      - { name: "Player1ID", type: "uuid.UUID" }
      - { name: "Player2ID", type: "uuid.UUID" }
      - { name: "StartedAt", type: "int64" }

  - name: "CombatActionOccurred"
    attributes:
      - { name: "DuelID", type: "uuid.UUID" }
      - { name: "AttackerID", type: "uuid.UUID" }
      - { name: "DamageDealt", type: "int" }
      - { name: "OpponentRemainingHP", type: "int" }
      - { name: "IsCritical", type: "bool" }
      - { name: "SpecialMove", type: "string" }

  - name: "DuelFinished"
    attributes:
      - { name: "DuelID", type: "uuid.UUID" }
      - { name: "WinnerID", type: "*uuid.UUID" }
      - { name: "VictoryType", type: "string" }
      - { name: "FinishedAt", type: "int64" }

repositories:
  - name: "DuelRepository"
    methods:
      - name: "FindByID"
        params: [{ name: "id", type: "uuid.UUID" }]
        returns: ["*DuelGame", "error"]
      - name: "Save"
        params: [{ name: "duel", type: "*DuelGame" }]
        returns: ["error"]

dependencies:
  - context: "Shared Kernel"
    reason: "Uses shared identifiers and base logic."
  - context: "Identity"
    reason: "References player profiles."
  - context: "Quiz Catalog"
    reason: "Fetches questions for the duel."
