# 🎮 Quick Duel (Быстрая дуэль)

## Общее описание

**Quick Duel** — основной PvP-режим приложения, где два игрока соревнуются в реальном времени, отвечая на одинаковые вопросы. Побеждает тот, кто наберёт больше очков за раунд.

---

## 📋 Основные параметры

| Параметр | Значение |
|----------|----------|
| Количество игроков | 2 |
| Вопросов за матч | 7 |
| Время на ответ | 10 секунд |
| Средняя длительность матча | 2-3 минуты |
| Тип матчмейкинга | По рейтингу (ELO) |
| Доступность | Бесплатно, без ограничений |

---

## 🎯 Игровой процесс

### Этап 1: Поиск соперника
```
┌─────────────────────────────────────┐
│                                     │
│     🔍 Поиск соперника...           │
│                                     │
│     [Аватар игрока]  VS  [?????]    │
│                                     │
│     ████████░░░░░░░░  Поиск...      │
│                                     │
│     [ Отменить поиск ]              │
│                                     │
└─────────────────────────────────────┘
```

**Логика матчмейкинга:**
- Первые 5 сек: ±50 ELO от рейтинга игрока
- 5-10 сек: ±100 ELO
- 10-15 сек: ±200 ELO
- 15+ сек: любой онлайн-игрок
- Fallback: бот с адаптивной сложностью

### Этап 2: Представление соперника
```
┌─────────────────────────────────────┐
│                                     │
│  [Аватар 1]        [Аватар 2]       │
│  PlayerOne    VS   QuizMaster99     │
│  ⭐ 1,250 ELO      ⭐ 1,180 ELO     │
│  🏆 142 победы     🏆 98 побед      │
│                                     │
│     Матч начнётся через: 3...       │
│                                     │
└─────────────────────────────────────┘
```
- Длительность: 3 секунды
- Показываем: аватар, никнейм, ELO, количество побед

### Этап 3: Игровой раунд (повторяется 7 раз)
```
┌─────────────────────────────────────┐
│  Вопрос 3/7              ⏱️ 00:08   │
│─────────────────────────────────────│
│                                     │
│  В каком году человек впервые       │
│  высадился на Луну?                 │
│                                     │
│  ┌─────────────┐  ┌─────────────┐   │
│  │   1965      │  │   1969  ✓   │   │
│  └─────────────┘  └─────────────┘   │
│  ┌─────────────┐  ┌─────────────┐   │
│  │   1972      │  │   1961      │   │
│  └─────────────┘  └─────────────┘   │
│                                     │
│─────────────────────────────────────│
│  👤 You: 2     ●●●○○○○    👤 Opp: 1 │
└─────────────────────────────────────┘
```

**Система начисления очков:**
| Действие | Очки |
|----------|------|
| Правильный ответ | +100 |
| Бонус за скорость (≤3 сек) | +50 |
| Бонус за скорость (≤5 сек) | +25 |
| Бонус за скорость (≤7 сек) | +10 |
| Неправильный ответ | 0 |
| Таймаут | 0 |

### Этап 4: Результат вопроса
```
┌─────────────────────────────────────┐
│                                     │
│           ✅ Правильно!             │
│                                     │
│    Ты: 1969 (2.3 сек) → +150 очков  │
│    Соперник: 1965 (4.1 сек) → 0     │
│                                     │
│    ─────────────────────────────    │
│    Счёт: 350 : 200                  │
│                                     │
└─────────────────────────────────────┘
```
- Длительность показа: 2 секунды
- Анимация: выделение правильного ответа, показ выбора соперника

### Этап 5: Финальный экран
```
┌─────────────────────────────────────┐
│                                     │
│          🏆 ПОБЕДА! 🏆              │
│                                     │
│     Финальный счёт: 650 : 420       │
│                                     │
│     +12 ELO  │  +25 монет           │
│     🔥 Серия: 3 победы подряд       │
│                                     │
│  ┌─────────────────────────────┐    │
│  │    🎬 Смотреть рекламу      │    │
│  │    Удвоить награду (+25)    │    │
│  └─────────────────────────────┘    │
│                                     │
│  [Реванш]  [Новый матч]  [Выход]    │
│                                     │
└─────────────────────────────────────┘
```

---

## 💰 Монетизация

### Реклама
| Точка показа | Тип рекламы | Обязательность |
|--------------|-------------|----------------|
| После матча | Interstitial (15-30 сек) | Каждый 3-й матч |
| Удвоение награды | Rewarded Video (30 сек) | Опционально |
| Поиск соперника >15 сек | Banner | Автоматически |

### Конверсия в премиум
- После 5+ матчей показываем: "Устал от рекламы? Премиум = 0 рекламы"
- При 3+ поражениях подряд: "Получи подсказки в премиум-версии"

---

## 📊 Метрики для отслеживания

| Метрика | Целевое значение |
|---------|------------------|
| Среднее время поиска соперника | < 10 сек |
| Completion rate (доигрывают матч) | > 85% |
| Матчей на игрока в день | 5-8 |
| Retention D1 (после первого матча) | > 40% |
| Ad view rate (rewarded) | > 35% |

---

## 🔧 Технические требования

### Realtime синхронизация
```
Клиент A                 Сервер                 Клиент B
    │                       │                       │
    │──── find_match ──────▶│                       │
    │                       │◀──── find_match ──────│
    │◀─── match_found ──────│────── match_found ───▶│
    │                       │                       │
    │◀─── question_1 ───────│─────── question_1 ───▶│
    │──── answer (2.3s) ───▶│                       │
    │                       │◀──── answer (4.1s) ───│
    │◀─── round_result ─────│────── round_result ──▶│
    │                       │                       │
    │        ... (повтор для каждого вопроса) ...   │
    │                       │                       │
    │◀─── match_result ─────│────── match_result ──▶│
```

### Обработка дисконнектов
- Переподключение: 10 сек grace period
- Если не вернулся: автоответ "таймаут" на текущий вопрос
- 2+ таймаута подряд: техническое поражение
- При дисконнекте соперника: победа + полная награда

### Античит
- Валидация времени ответа на сервере
- Минимальное время ответа: 0.5 сек (защита от автокликеров)
- Проверка паттернов ответов (выявление ботов)
- Rate limiting: макс 1 ответ в 0.5 сек

---

## 🎨 UI/UX рекомендации

### Анимации
- Появление вопроса: fade-in 0.3 сек
- Выбор ответа: scale pulse 1.0 → 1.05 → 1.0
- Правильный ответ: зелёная подсветка + confetti
- Неправильный: красная подсветка + shake
- Таймер: пульсация при <3 сек

### Звуки
- Тик таймера (последние 3 сек)
- Правильный ответ: позитивный звук
- Неправильный: нейтральный звук (не раздражающий)
- Победа: фанфары
- Поражение: нейтральная мелодия

### Хаптика (вибрация)
- Выбор ответа: лёгкая вибрация
- Правильный ответ: короткая позитивная
- Победа в матче: паттерн "celebration"

---

## 🔄 Особые механики

### Серия побед (Win Streak)
- 3 победы подряд: +10% к наградам
- 5 побед подряд: +25% к наградам
- 10 побед подряд: +50% + уникальная рамка

### Защита новичков
- Первые 10 матчей: только против игроков с <15 матчами
- Отдельный "новичковый" пул вопросов (проще)
- Гарантированные награды даже за поражение

### Система ELO
- Начальный рейтинг: 1000
- K-фактор: 32 (первые 30 матчей), затем 16
- Минимальный ELO: 100 (не падает ниже)
- Сезонный soft reset: (ELO - 1000) / 2 + 1000

---

## 📱 Состояния экрана

| Состояние | Описание |
|-----------|----------|
| `idle` | Главный экран режима, кнопка "Найти матч" |
| `searching` | Поиск соперника, можно отменить |
| `found` | Соперник найден, показ профилей |
| `playing` | Активный раунд с вопросом |
| `round_result` | Показ результата вопроса |
| `match_result` | Финальный экран с наградами |
| `disconnected` | Потеря соединения, попытка реконнекта |

---

## ✅ Чек-лист запуска

- [ ] Матчмейкинг работает < 15 сек
- [ ] Синхронизация вопросов точная (±100ms)
- [ ] Реклама не крашит приложение
- [ ] Дисконнекты обрабатываются корректно
- [ ] ELO считается правильно
- [ ] Награды начисляются
- [ ] Звуки и анимации работают
- [ ] Античит активен
